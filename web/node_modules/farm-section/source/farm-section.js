/*! farm_router v0.00.0 | (c) 2015 SAM Staff, Inc. | 

           					   \|||/
                               (o o)
                      ------ooO-(_)-Ooo------

*/
// http://stackoverflow.com/questions/13673346/supporting-both-commonjs-and-amd

// Append Before:
// element.parentNode.insertBefore(newElement, element);
// Append After:
// element.parentNode.insertBefore(newElement, element.nextSibling);

// referenceNode.parentNode.insertBefore( newNode, referenceNode )
// referenceNode.parentNode.insertBefore( referenceNode, newNode )


(function(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define([], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory();
    } else {
        root.farm_section = factory();
    }
}(this, function() {
    'use strict';

    var defaults = {
            pages           :{ default  :'default' }
            //close           :function (){ return true; },
    };

    var opts = '';



    function farm_section(options) {

        //console.log('---------------------@@@@@ farm_section @@@@@---------------------------')

        opts = extend( defaults, options);

        var dta = '<div id="farm-main" class="farm-perspective"></div>';

        var div = document.createElement('div');
        div.innerHTML = dta;
        //document.body.appendChild(div.firstChild);
        document.body.insertBefore(div.firstChild, document.body.firstChild);

        var p = opts.pages;

        for (var i in p) { 
            if (p.hasOwnProperty(i)) { 
                //console.log('Loading pages: '+ p[i]);
                pages(p[i], 'farm-main');
            }
        }
    };

    function pages (id, page) {
        /*
        var res = html.replace( /\{\{(.*?)\}\}/g, function(x){   
                console.log(x)
               // this grabs replacement tags
            return x.replace( /\[(\d+)\]/g,'.$1' )
        }); 
        */
        //var html = document.getElementById('tpl-section').innerHTML

        var html = 
            '<section id="{{id}}" class="farm-page">'+
                '<section class="farm-pusher" id="{{id}}-pusher">'+
                    '<section id="{{id}}-page" class="{{id}}-page farm-content">'+
                        '<span class="farm-spinner-overlay">'+
                            '<p class="farm-spinner" viewbox="0 0 256 256" icon="#farm_spinner"></p>'+
                        '</span>'+
                    '</section>'+
                '</section>'+
            '</section>';

        //verificamos que el id no esta repetido
        var x = document.getElementById(page);
        var z = document.getElementById(id);

        if(typeof(z) != 'undefined' && z != null){
            //console.log(z)
            x.removeChild(z);
            console.error('Alert! page repetida id: '+id)
        }
        var output = html.replace( /\{\{(.*?)\}\}/g, id);  
        x.innerHTML += output;
    };

    farm_section.base = function(path) {

        //console.log(farm.o.mode+' | path: ', path)

        var current = document.querySelectorAll("[farm-select=true]");
        var next    = document.querySelectorAll('section#'+path);

        //console.log('current: ', current)
        //console.log('next: ', next)

        for(var i=0;i<current.length;i++){
            current[i].removeAttribute('farm-select');
        }
        if (next.length > 0){
            //console.log('next1: ', next)
            next[0].setAttribute('farm-select', true);
        }
        else{
            //console.log('next2: ', next)
            //console.error('farm_section: next empty')
        }

        /*
        console.log('---',path)

        console.log('---',defaults)

        console.log('options: ', opts)

        console.log('options: ',arguments  )

        */
    };

    /////////////////////////////////////////////////////////////////////////////////

    //http://stackoverflow.com/questions/11197247/javascript-equivalent-of-jquerys-extend-method
    function extend(){
        for(var i=1; i<arguments.length; i++)
            for(var key in arguments[i])
                if(arguments[i].hasOwnProperty(key))
                    arguments[0][key] = arguments[i][key];

        return arguments[0];
    }
    

    return farm_section;
}));





